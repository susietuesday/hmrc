<!DOCTYPE html>

<html lang="en">

<script>
  function getOrCreateDeviceId() {
    const match = document.cookie.match(/(^|;) ?deviceId=([^;]*)(;|$)/);
    if (match) return match[2];

    const newId = crypto.randomUUID();
    document.cookie = `deviceId=${newId}; path=/; max-age=31536000`; // 1 year
    return newId;
  }

  const deviceId = getOrCreateDeviceId();

  function getUtcOffset() {
    const offsetMinutes = new Date().getTimezoneOffset(); // minutes behind UTC (e.g. 60 means UTC-1)
    const sign = offsetMinutes <= 0 ? '+' : '-';
    const absMinutes = Math.abs(offsetMinutes);
    const hours = String(Math.floor(absMinutes / 60)).padStart(2, '0');
    const minutes = String(absMinutes % 60).padStart(2, '0');
    return `UTC${sign}${hours}:${minutes}`;
  }

  fetch('/session-data', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-User-Agent': navigator.userAgent,
      'X-Device-Id': deviceId
    },
    body: JSON.stringify({
      screenInfo: {
        width: window.screen.width,
        height: window.screen.height,
        scalingFactor: window.devicePixelRatio || 1,
        colourDepth: window.screen.colorDepth
      },
      timezone: getUtcOffset()
    })
  });
</script>


<head>
  <meta charset="UTF-8">
  <title>Making Tax Digital</title>

  <!-- ✅ Bootstrap 5 CSS (no jQuery needed) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- ✅ Bootstrap 5 JS bundle (includes Popper, no jQuery needed) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body>
<div class="container">
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">api-example-nodejs-client</a>
            </div>
        </div>
    </nav>

    <h1>Testing <%= service %> API</h1>

    <div>
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th>Endpoint</th>
                <th>Description</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td><%= unRestrictedEndpoint %></td>
                <td>Unrestricted endpoint</td>
                <td>
                    <a class="btn btn-primary" href="unrestrictedCall">Try it</a>
                </td>
            </tr>
            <tr>
                <td><%= appRestrictedEndpoint %></td>
                <td>Application restricted endpoint</td>
                <td>
                    <a class="btn btn-primary" href="applicationCall">Try it</a>
                </td>
            </tr>
            <tr>
                <td><%= userRestrictedEndpoint %></td>
                <td>User restricted endpoint</td>
                <td>
                    <a class="btn btn-primary" href="userCall">Try it</a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <h2>Log Out</h2>

    <form action="/logout" method="POST">
        <button type="submit">Log Out</button>
    </form>

    <h2>Get Services</h2>

    <form action="/services" method="GET">
        <button type="submit">Get Services</button>
    </form>

    <h2>Create Test User</h2>

    <form action="/test-users" method="POST">
        <button type="submit">Create Test User</button>
    </form>

    <form action="/itsa-status" method="POST">
        <label for="nino">National Insurance Number:</label>
        <input type="text" name="nino" id="nino" required>
        <label for="taxYear">Tax Year:</label>
        <input type="text" name="taxYear" id="taxYear" required>
        <button type="submit">Create Test ITSA Status</button>
    </form>

    <h2>Retrieve ITSA Status</h2>

    <form action="/itsa-status" method="GET">
        <label for="nino">National Insurance Number:</label>
        <input type="text" name="nino" id="nino" required>
        <label for="taxYear">Tax Year:</label>
        <input type="text" name="taxYear" id="taxYear" required>
        <button type="submit">Retrieve ITSA Status</button>
    </form>

    <h2>Retrieve Income and Expenditure Obligations</h2>

    <form action="/obligations" method="GET">
        <label for="nino">National Insurance Number:</label>
        <input type="text" name="nino" id="nino" required>
        <button type="submit">Retrieve Obligations</button>
    </form>

    <h2>Business Income Sources</h2>

    <form action="/business-sources" method="GET">
        <label for="nino">National Insurance Number:</label>
        <input type="text" name="nino" id="nino" required>
        <button type="submit">Fetch Business Sources</button>
    </form>

    <form action="/test/uk-property-business" method="POST">
        <label for="nino">National Insurance Number:</label>
        <input type="text" name="nino" id="nino" required>
        <button type="submit">Create test UK Property Business</button>
    </form>

    <h2>Submit Property Period Summary</h2>

    <form action="/periodic-summary" method="POST">
        <label for="nino">National Insurance Number:</label>
        <input type="text" name="nino" id="nino" required>
        <button type="submit">Submit Summary</button>
    </form>
</div>
</body>
</html>
