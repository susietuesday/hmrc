<div class="row justify-content-center">
  <div class="col-lg-8">    

    <!-- Quarterly Update Panel -->
    <div class="card mt-4">
      <div class="card-header bg-dark text-white">Upload Quarterly Update</div>
      <div class="card-body">
        <div class="mb-3">
            <!-- File select -->
            <input class="form-control" type="file" id="csvFile" accept=".csv">
            <div id="errorMessages" style="color: red;"></div>
        </div>

        <!-- Upload csv file button -->
        <button id="uploadBtn" class="btn btn-primary" disabled>Upload CSV</button>

        <div id="uploadStatus" class="mt-3"></div>  <!-- Upload csv file button -->
        <div id="csvPreview" class="mt-3"></div>    <!-- Csv file preview panel -->

        <div id="hiddenSection" style="display: none; margin-top: 20px;">
          <!-- Signposting -->
          <div class="alert alert-info mt-3" role="alert">
            <h5 class="alert-heading mb-2">Submit an interim update</h5>
            <p class="mb-2">
              Choose an <strong>Update to</strong> date. Your totals should include all transactions up to that date.
            </p>
          </div>

          <!-- Submission to date -->
          <label for="toDate" class="form-label">Update to (inclusive)</label>
          <input
            type="date"
            id="toDate"
            name="toDate"
            class="form-control"
            min="<%= fromDate %>"
            max="<%= maxToDate %>"
            value="<%= new Date().toISOString().split('T')[0] %>" />
          <p class="text-secondary mt-1">
            Your update will cover <strong><%= fromDate %></strong> to
            <strong id="toDateLabel"><%= toDate %></strong>.
          </p>

          <!-- Validation message -->
          <% if (typeof error !== 'undefined') { %>
            <div class="alert alert-danger error-message"><%= error %></div>
          <% } %>

          <!-- Submit button -->
          <form action="/summary" method="POST" class="mt-3">
            <button type="submit" class="btn btn-primary btn-lg w-100">
              Submit summary
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const toDateInput = document.getElementById('toDate');
  const lbl = document.getElementById('toDateLabel');
  toDateInput.addEventListener('input', () => lbl.textContent = toDateInput.value);
</script>

<script>
  <% if (typeof error !== 'undefined' && error) { %>
    document.addEventListener('DOMContentLoaded', function() {
      var hiddenSection = document.getElementById('hiddenSection');
      if (hiddenSection) hiddenSection.style.display = 'block';
    });
  <% } %>
</script>


<script type="module" src="quarterlyPage.js"></script>